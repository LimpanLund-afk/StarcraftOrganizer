@page "/register"

@using Microsoft.AspNetCore.Identity
@using StarcraftOrganizer.Data.Entities

@inject UserManager<Player> UserManager
@inject SignInManager<Player> SignInManager
@inject NavigationManager NavigationManager

<Page>
    <ChildContent>
        <h3>Registrera</h3>

        <EditForm Model="@registerModel" OnValidSubmit="HandleRegister">
            <InputText @bind-Value="registerModel.UserName" placeholder="Användarnamn" />
            <InputText @bind-Value="registerModel.Email" placeholder="Email" />
            <InputText @bind-Value="registerModel.Password" type="password" placeholder="Lösenord" />
            <button type="submit">Registrera</button>
        </EditForm>

    </ChildContent>
</Page>

@code {
    private RegisterModel registerModel = new();

    private async Task HandleRegister()
    {
        var player = new Player
            {
                UserName = registerModel.UserName,
                Email = registerModel.Email
            };

        var result = await UserManager.CreateAsync(player, registerModel.Password);
        if (result.Succeeded)
        {
            await SignInManager.SignInAsync(player, isPersistent: false);
            NavigationManager.NavigateTo("/");
        }
    }

    private class RegisterModel
    {
        public string UserName { get; set; }
        public string Email { get; set; }
        public string Password { get; set; }
    }
}
